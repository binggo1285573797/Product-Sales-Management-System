{% extends "base.html" %}

{% block title %}商品销售管理系统{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="text-center mb-5">
            <i class="fas fa-store fa-5x text-primary mb-4"></i>
            <h1 class="display-4 fw-bold text-primary">商品销售管理系统</h1>
            <p class="lead text-muted">基于Python Flask + MySQL的轻量级销售管理解决方案</p>
        </div>
        
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card h-100 shadow">
                    <div class="card-body text-center">
                        <i class="fas fa-user-shield fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">管理员登录</h5>
                        <p class="card-text">系统管理员登录入口，拥有完整的管理权限</p>
                        <a href="/login" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt me-2"></i>管理员登录
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-4">
                <div class="card h-100 shadow">
                    <div class="card-body text-center">
                        <i class="fas fa-comment-dots fa-3x text-success mb-3"></i>
                        <h5 class="card-title">客户留言</h5>
                        <p class="card-text">客户可以在此提交留言和反馈</p>
                        <button class="btn btn-success" onclick="showMessageModal()">
                            <i class="fas fa-edit me-2"></i>提交留言
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-body">
                        <h5 class="card-title text-center mb-4">
                            <i class="fas fa-star me-2"></i>系统特色功能
                        </h5>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="text-center">
                                    <i class="fas fa-shopping-cart fa-2x text-primary mb-2"></i>
                                    <h6>订单管理</h6>
                                    <small class="text-muted">完整的订单生命周期管理</small>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="text-center">
                                    <i class="fas fa-chart-bar fa-2x text-success mb-2"></i>
                                    <h6>销售统计</h6>
                                    <small class="text-muted">多维度数据分析和可视化</small>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="text-center">
                                    <i class="fas fa-robot fa-2x text-info mb-2"></i>
                                    <h6>智能问数</h6>
                                    <small class="text-muted">自然语言查询销售数据</small>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="text-center">
                                    <i class="fas fa-crystal-ball fa-2x text-warning mb-2"></i>
                                    <h6>销量预测</h6>
                                    <small class="text-muted">基于历史数据的智能预测</small>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="text-center">
                                    <i class="fas fa-users fa-2x text-danger mb-2"></i>
                                    <h6>用户管理</h6>
                                    <small class="text-muted">多角色权限控制系统</small>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="text-center">
                                    <i class="fas fa-tags fa-2x text-secondary mb-2"></i>
                                    <h6>商品管理</h6>
                                    <small class="text-muted">商品和种类分类管理</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-5">
            <small class="text-muted">
                默认管理员账号：admin / admin123
            </small>
        </div>
    </div>
</div>

<!-- 留言模态框 -->
<div class="modal fade" id="messageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">客户留言</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="messageForm">
                    <div class="mb-3">
                        <label for="customerName" class="form-label">您的姓名</label>
                        <input type="text" class="form-control" id="customerName" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactInfo" class="form-label">联系方式</label>
                        <input type="text" class="form-control" id="contactInfo" required placeholder="电话或邮箱">
                    </div>
                    <div class="mb-3">
                        <label for="messageContent" class="form-label">留言内容</label>
                        <textarea class="form-control" id="messageContent" rows="4" required placeholder="请输入您的留言内容..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="submitMessage()">提交留言</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 显示留言模态框
function showMessageModal() {
    document.getElementById('messageForm').reset();
    
    const modal = new bootstrap.Modal(document.getElementById('messageModal'));
    modal.show();
}

// 提交留言
function submitMessage() {
    const customerName = document.getElementById('customerName').value.trim();
    const contactInfo = document.getElementById('contactInfo').value.trim();
    const messageContent = document.getElementById('messageContent').value.trim();
    
    if (!customerName || !contactInfo || !messageContent) {
        showMessage('请填写所有必填字段', 'warning');
        return;
    }
    
    const submitBtn = document.querySelector('#messageModal .btn-primary');
    const originalText = submitBtn.innerHTML;
    showLoading(submitBtn);
    
    apiRequest('/message/submit', 'POST', {
        customer_name: customerName,
        contact_info: contactInfo,
        content: messageContent
    })
        .then(response => {
            hideLoading(submitBtn, originalText);
            
            if (response.code === 1) {
                showMessage('留言提交成功，我们会尽快回复', 'success');
                bootstrap.Modal.getInstance(document.getElementById('messageModal')).hide();
            } else {
                showMessage(response.msg, 'danger');
            }
        });
}
</script>
{% endblock %}

